---
title: "LMA"
author: "Wei Li, Florence Yan, Ziyu Jin"
date: "`r format(Sys.time(), '%B %d, %Y')`"
output:
  html_document:
    toc: yes
    toc_depth: '3'
  html_notebook:
    number_sections: yes
    toc: yes
    toc_depth: 3
    toc_float: yes
---

```{r echo = FALSE}
# Course: BUAN 5210
# Title: LMA Assignment
# Research questions: 
## 1. In the state of Washington, how do earnings vary by educational attainment?
## 2. Does the premium for higher education vary by race?
# Date: January 29, 2019
# Author: Wei Li, Florence Yan, Ziyu Jin
```

```{r echo = FALSE}
# Clear environment of variables and functions
rm(list = ls(all = TRUE)) 
# Clear environmet of packages
if(is.null(sessionInfo()$otherPkgs) == FALSE)lapply(paste("package:", names(sessionInfo()$otherPkgs), sep=""), detach, character.only = TRUE, unload = TRUE)
```

```{r message = FALSE}
library(tidyverse)
library(ggplot2)
```


# Data preparation
```{r}
### Load data
wa_data <- read.csv('ss16pwa.csv')
### Subset and focus on the data of interest
# SERIALNO: Housing unit/GQ person serial number  
# SPORDER: Person number
# SEX: Sex                                        
# CIT: Citizenip status
# PERNP: Total person's earnings                  
# SCHL: Educational attainment
# RAC1P: Recoded detailed race code               
# ESR: Employment status
# WKHP: Usual hours worked per week past 12 months
research_data <- wa_data[c('SERIALNO','SPORDER','SEX', 'CIT','PERNP','SCHL','RAC1P','ESR', 'WKHP')]
summary(research_data)
```

# Data cleaning
```{r}
# exclude all missing values
new <- na.exclude(research_data) 
# exclude those who cannot work due to age under 16 years old or not in labor force.
new <- new[new['ESR'] != 6, ]
## total person's earnings more than or equal to $1
new <- new[new['PERNP'] >= 0000001, ]
## full time workers
new <- new[new['WKHP'] >= 40, ]

## group educational attainment levels into 5 levels: 
# A: with degrees no higher than high school; 
# B: with colleage degree; 
# C: with professional degree;
# D: with master degree; 
# E: with Doctor degree
for (rows in 1:nrow(new)) {
  if (new[rows, 'SCHL'] <= 19) {
    new[rows, 'EducLevel'] = 'A'
  }
  if (new[rows, 'SCHL'] >= 20 & new[rows, 'SCHL'] <= 21) {
    new[rows, 'EducLevel'] = 'B'
  }
  if (new[rows, 'SCHL'] == 23) {
    new[rows, 'EducLevel'] = 'C'    
  }
  if (new[rows, 'SCHL'] == 22) {
    new[rows, 'EducLevel'] = 'D'
  }
  if (new[rows, 'SCHL'] == 24) {
    new[rows, 'EducLevel'] = 'E'
  }
}
```


```{r}
# Redefine variable citizenship
# 1: US Citizen
# 2: Not US Citizen
for (rows in 1:nrow(new)) {
  if (new[rows, 'CIT'] != 5) {
    new[rows, 'CIT'] = 1
  }
  if (new[rows, 'CIT'] == 5) {
    new[rows, 'CIT'] = 2
  }
}

# Columns name change
new <- new[c("SERIALNO", "SPORDER","SEX", "CIT", "PERNP", "RAC1P", "EducLevel", "WKHP")]
colnames(new) <- c("Housing_Unit","Person_Number", "Sex", "Citizenship", "Total_Person_Earning", "Race", "EducLevel", "Working_Time")

# Change the data type
new$Citizenship <- as.factor(new$Citizenship)
new$Sex <- as.factor(new$Sex)
new$Race <- as.factor(new$Race)
new$EducLevel <- as.factor(new$EducLevel)

summary(new)
```

# Data modeling
```{r }
mod <- lm(Total_Person_Earning ~ EducLevel + Sex + Citizenship + Race + Working_Time, data = new)
summary(mod)
```

#Sample Selection Criteria

+ We use individual-level data in Washington State from the 2016 American Community Survey (ACS) to examine earning gaps between individuals with different educational attainments. The American Community Survey (ACS) is a national survey that uses continuous measurement methods. In this survey, a series of monthly samples produce annual estimates for the same small areas (census tracts and block groups) formerly surveyed via the decennial census long-form sample. In our study, we define workers as individuals who are over 16 years old and full-time workers who work more than or equal to 40 hours per week. Our sample consists of 24,710 individuals in total. Specifically, there are 12,050 people with or without high school diploma, 8,830 people with college degree, 620 people with professional degree, 2,775 people with masterâ€™s degree, and 435 people with doctor degree. Regarding total personal earning, we define it as individuals who earns over $1 during the past year. 


#Descriptive statistics and exploratory data analysis
```{r echo=FALSE}
str(new)
```

+ In this study, the dependent variable is a set of quantititve values named Total_Person_Earning. It is the record for th total person's earnings. We only include earnings over $1 in the past year.

+ The independent variable we are interested are education level(EducLevel), Race, Sex, Citizenship. Values in these columns are categorical.

+ Sex is the gender record.

+ Citizenship is to mark the person is or isn't US citizen.

+ Race is the race record. 9 races in total.

+ EducLevel is the education level of each person. There are 5 levels:  A: with degrees no higher than high school; B: with colleage degree; C: with professional degree; D: with master's degree; E: with doctor degree.

+ Working time is the usual hours each individual worked per week past 12 months. Our target individuals are full time workers. Thus, we only include people who worked more than or equal to 40 hours per week in the past year.

```{r}
summary(new)
```

+ There are more males than females in our research.

+ The majority in our dataset are US Citizens. So it might be difficult to detect whether citizenship has the premium of high earnings.

+ The ratio of the races is also unbalanced in which White is the majority.

+ For Education level, there are large number of people who don't have a college degree. Also large number of people whose highest degree is college degree.

+ In our dataset, the mean of the total person's earning is about $68,916; median is $50,000; minimum is $1; maximum is $850,000  

```{r echo=FALSE}
boxplot(new$Total_Person_Earning, main = "Boxplot of earnings") 
```

+ From the boxplot we can see, there are extreme values on the top. So the distribution of the earnings should be positively skewed. Fo the skewed data, we will use median to represent the majority's earning level.

```{r echo=FALSE, warning=FALSE}
EducLevel_pic <- ggplot(new, aes(x = EducLevel)) + geom_histogram(stat = "count") + labs(title = "Educational Level in WA")
EducLevel_pic
```

+ From the graph, we can tell that the least number of people got doctor degree; most of the people attained high school degrees or college degrees.

```{r echo=FALSE, warning=FALSE}
# median earnings of each educlevel
Educ_earning_pic <- new %>% 
  group_by(EducLevel) %>% 
  summarise(med_earning = median(Total_Person_Earning)) %>% 
  ggplot(aes(x = EducLevel, y = med_earning)) +
  geom_histogram(stat = "identity")
Educ_earning_pic

```


+ The histogram graph shows the relationship between educational level and total personal earnings in our dataset. From the graph, we can tell that people whose education attainments are below or eaqual to high school earn least in the group; people with professional degrees earn most money compared to other groups.

```{r echo=FALSE, warning=FALSE}
# 1 .White alone
# 2 .Black or African American alone
# 3 .American Indian alone
# 4 .Alaska Native alone
# 5 .American Indian and Alaska Native tribes specified; or American Indian or Alaska Native, not specified and no other races 
# 6 .Asian alone
# 7 .Native Hawaiian and Other Pacific Islander alone
# 8 .Some Other Race alone
# 9 .Two or More Races
race_wa <- ggplot(new, aes(x = Race)) + geom_histogram(stat = "count") + labs(title = "Race in WA")
race_wa
```


+ From the graph, we can see that the majority of people in WA are whites; the second largest group is Asian (alone) group; there are very few Alaska Native or American Indian in WA.

```{r echo=FALSE, warning=FALSE}
earning_educ_race_pic <- new %>% 
  group_by(Race, EducLevel) %>% 
  summarise(med_earn = median(Total_Person_Earning)) %>% 
  ggplot(aes(x = EducLevel, y = med_earn, fill = Race)) +
  geom_bar(position = 'dodge', stat = 'identity')
earning_educ_race_pic

```

+ The graph shows the relationship between total personal earning, educational level, and races. 
